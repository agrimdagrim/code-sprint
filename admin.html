<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin Dashboard</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
       .controls { background: #eee; padding: 20px; margin-bottom: 20px; }
        button { padding: 15px; font-size: 1.2rem; cursor: pointer; margin-right: 10px; }
       .green { background: green; color: white; }
       .red { background: red; color: white; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    </style>
</head>
<body>
    <div class="controls">
        <h1>Admin Controls</h1>
        <p>Status: <strong id="status">...</strong></p>
        <button id="btn-start" class="green">START GAME</button>
        <button id="btn-stop" class="red">STOP GAME</button>
    </div>

    <h2>Live Leaderboard</h2>
    <table>
        <thead><tr><th>Rank</th><th>Name</th><th>Score</th></tr></thead>
        <tbody id="leaderboard"></tbody>
    </table>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, updateDoc, onSnapshot, collection, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // --- PASTE YOUR FIREBASE CONFIG HERE ---
        const firebaseConfig = {
  apiKey: "AIzaSyAxE15bKJMkKPEGxm3aF_ih8L6bY7B0R9w",
  authDomain: "crossword-sprint.firebaseapp.com",
  projectId: "crossword-sprint",
  storageBucket: "crossword-sprint.firebasestorage.app",
  messagingSenderId: "152789480102",
  appId: "1:152789480102:web:c49c82b5beafa31093ba67",
  measurementId: "G-G5MWLKCBZW"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const COMP_ID = "sprint_001";

        // Admin Auth
        signInWithPopup(auth, new GoogleAuthProvider());

        // Controls
        document.getElementById('btn-start').onclick = () => {
            updateDoc(doc(db, 'competitions', COMP_ID), { status: 'active' });
        };
        document.getElementById('btn-stop').onclick = () => {
            updateDoc(doc(db, 'competitions', COMP_ID), { status: 'stopped' });
        };

        // Status Listener
        onSnapshot(doc(db, 'competitions', COMP_ID), (snap) => {
            document.getElementById('status').textContent = snap.data()?.status;
        });

        // Leaderboard Listener
        const playersRef = collection(db, 'competitions', COMP_ID, 'players');
        const q = query(playersRef, orderBy('solvedCount', 'desc'), orderBy('lastSolved', 'asc'));

        onSnapshot(q, (snapshot) => {
            const tbody = document.getElementById('leaderboard');
            tbody.innerHTML = '';
            let rank = 1;
            snapshot.forEach(d => {
                const p = d.data();
                tbody.innerHTML += `<tr><td>${rank++}</td><td>${p.name}</td><td>${p.solvedCount}</td></tr>`;
            });
        });
    </script>
</body>
</html>